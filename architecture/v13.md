# Budget & Ledger – Architecture Reference
## Version 13 (Authoritative)

This document is the **single source of truth** for the Budget & Ledger project architecture.
It defines **meaning, structure, and intent**. It does **not** define formulas, automation, or styling.

---

## 1. System Scope & Operating Model

### 1.1 Monthly System
- Operates on a monthly cadence
- Precision is required at **month close**
- Intra-month imbalance is acceptable

At month close, the system must answer:
> What cash did we have, and what was it allocated to?

---

### 1.2 Two Parallel Truths (Intentional)

**Cash Reality**
- One real checking account
- End-of-month balance is authoritative
- Next month opens with prior month’s closing balance

**Budget Intent**
- Forward-looking
- Based on planned income
- Not constrained by starting cash
- Must reconcile to reality by month close

These truths are separate by design.

---

## 2. Core Principles

1. **Single-Account Reality**  
   No account tracking. One cash number per month.
2. **Ledger Is Historical Truth**  
   Mirrors the bank. Posted date is truth. Amounts never change.
3. **Categories Explain, Buckets Allocate**  
   Categories describe spending. Buckets represent intent over time.
4. **Explicit Beats Implicit**  
   Allocation meaning changes only via Transfers.
5. **Judgment Is Central**  
   No enforced “smart” rules. Human decisions are expected.

---

## 3. Allocation Bucket Model

### 3.1 Persistence
- Buckets exist independently of months
- Buckets are created intentionally only
- Buckets are never auto-created
- Zero-balance buckets may be hidden but never deleted

### 3.2 Allocation Categories
Exactly three top-level allocation categories:
- Flex
- Savings
- Long-Term Savings

All buckets belong to one of these.

### 3.3 Temporary Buckets
- Temporary buckets are normal buckets
- They naturally return to zero
- They remain available for reuse

### 3.4 Balances
- Any bucket may be positive or negative
- No balance restrictions are enforced

---

## 4. Monthly Allocation Snapshot

For each bucket, per month:
- Starting Balance
- Amount Added
- Amount Removed
- Final Balance

Rules:
- Starting balance comes from the prior month
- Added/Removed are derived from Transfers
- Final balances must reconcile to cash at month close

---

## 5. Transfers (Allocation & Budget Control)

Transfers are the **only mechanism** for changing allocation meaning or budget capacity.

One Transfers table supports:
- Budget → Budget
- Allocation → Budget
- Budget → Allocation
- Allocation → Allocation

Transfers are not income, expenses, or ledger entries.

### 5.1 Allocation → Budget (Increased Budget Capacity)

Purpose:
> Increase budget capacity using existing cash.

Effects:
- Allocation decreases
- Budget capacity increases
- No income is created

Appears in Month Summary as:
**Increased Budget Capacity (from allocations)**

### 5.2 Budget → Allocation (Surplus / Saving)

Purpose:
> Remove spending permission and assign it to allocations.

Invariant:
> Budget capacity decreases by the same amount moved to allocations.

---

## 6. Budget Model

### 6.1 Budget as Planning Layer
- Budget does not hold money
- Budget expresses permission to spend
- Categories are analytical only

Each category has:
- Projected
- Actual
- Difference

---

## 7. Month Summary (F2)

The Month Summary explains **why the budget was allowed to be the size it was**.

### 7.1 Income & Reality
- Actual Income (ledger deposits)
- Refunds (expense reversals, not income)

### 7.2 Planning Inputs
- Planned Monthly Income
- Planned Extra Income (visibility only)

### 7.3 Budget Capacity Adjustments
- Increased Budget Capacity (from allocations)
- Extra Income converted to budget capacity (explicit decision)

### 7.4 Budget Capacity Overview
- Planned Monthly Income
+ Budget Capacity Increases
- Budget → Allocation transfers
= Total Budget Capacity Available

---

## 8. Extra Income Model

Rule:
> Extra income is real income, but requires an explicit allocation decision before it can be spent.

Flow:
1. Arrives as ledger deposit
2. Appears in Actual Income
3. Becomes budget capacity
4. Decision shown in budget
5. Transfers execute saving or spending

---

## 9. Ledger Model

### 9.1 Bank Fidelity
- One parent row per bank transaction
- Posted date is truth
- Amounts match bank

### 9.2 Splits
- Parent row + 0..n split rows
- Splits carry categories
- Sum of splits equals parent amount

### 9.3 Categories
- Global and long-lived
- Analytical only
- Never auto-deleted

### 9.4 Unassigned
- Allowed mid-month
- Must be zero at month close
- Visible as work-to-do

---

## 10. Refunds

- Recorded as positive ledger entries
- Categorized as expense reversals
- Increase cash, not income
- Do not auto-increase budget capacity

---

## 11. Month Close Philosophy

- Months are treated as final once closed
- Reopening is possible but rare and discouraged
- Corrections handled via:
  - Allocation adjustments
  - Budget Overage
  - Future-month reconciliation

---

## 12. Budget Overage

- Flex bucket
- Pressure-release valve
- Represents noise or simplification
- Not treated as savings performance

---

## 13. Definition of V13 Done

V13 is complete when:
- Every concept above has a physical place
- No formulas exist
- No automation exists
- The workbook explains itself
